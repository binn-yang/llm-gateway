# LLM Gateway å¯¹è¯åˆ†ææŠ¥å‘Š
## åŸºäº 2026-02-03 æ—¥å¿—

---

## ğŸ“Š ç»Ÿè®¡æ¦‚è§ˆ

- **æ€»è¯·æ±‚æ•°**: 22ä¸ª
- **å®Œæ•´å¯¹è¯**: 7ä¸ªï¼ˆåŒ…å«è¯·æ±‚å’Œå“åº”ï¼‰
- **ä¸»è¦æ¨¡å‹**: claude-haiku-4-5-20251001 (15æ¬¡), claude-sonnet-4-5 (7æ¬¡)
- **API Key**: y111
- **Tokenæ€»æ¶ˆè€—**: çº¦43,000 tokens (input + output)

---

## ğŸ’¬ å…¸å‹å¯¹è¯ç¤ºä¾‹

### ç¤ºä¾‹1: ç®€å•é—®å€™ + JSON Schemaè¾“å‡º

**ã€ç³»ç»Ÿæç¤ºè¯ã€‘**:
```
1. x-anthropic-billing-header: cc_version=2.1.29.307; cc_entrypoint=cli;
2. You are Claude Code, Anthropic's official CLI for Claude.
3. Analyze if this message indicates a new conversation topic. 
   If it does, extract a 2-3 word title that captures the new topic. 
   Format your response as a JSON object with two fields: 
   'isNewTopic' (boolean) and 'title' (string, or null if isNewTopic is false).
```

**ã€ç”¨æˆ·è¾“å…¥ã€‘**: "hi"

**ã€é…ç½®ã€‘**:
- max_tokens: 32000
- stream: true
- output_format: json_schema (çº¦æŸè¾“å‡ºæ ¼å¼)
  - Schemaå­—æ®µ: isNewTopic, title

**ã€LLMå“åº”ã€‘**: "New Conversation"

**ã€Tokenä½¿ç”¨ã€‘**: 
- è¾“å…¥: 10 tokens
- è¾“å‡º: 2 tokens

---

### ç¤ºä¾‹2: å·¥å…·è®¡æ•°ï¼ˆæé™ä¼˜åŒ–ï¼‰

**ã€ç³»ç»Ÿæç¤ºè¯ã€‘**: (æ— )

**ã€ç”¨æˆ·è¾“å…¥ã€‘**: "count"

**ã€é…ç½®ã€‘**:
- max_tokens: **1** (ä»…å…è®¸1ä¸ªtokenè¾“å‡ºï¼)
- stream: false
- tools: 46ä¸ªå·¥å…· (åŒ…å«web-search, web-reader, playwright, greptileç­‰MCPå·¥å…·)

**ã€LLMå“åº”ã€‘**: "I"  (åªè¾“å‡ºäº†1ä¸ªå­—æ¯ï¼Œå› ä¸ºmax_tokens=1)

**ã€Tokenä½¿ç”¨ã€‘**: 
- è¾“å…¥: 10,116 tokens (åŒ…å«æ‰€æœ‰å·¥å…·å®šä¹‰)
- è¾“å‡º: 1 token

**ğŸ’¡ è®¾è®¡æ„å›¾**: è¿™æ˜¯ä¸€ä¸ªtokenè®¡æ•°è¯·æ±‚ï¼Œé€šè¿‡æå°çš„max_tokensé™åˆ¶æ¥å¿«é€Ÿç»Ÿè®¡å·¥å…·å®šä¹‰æ¶ˆè€—çš„tokenæ•°ã€‚

---

### ç¤ºä¾‹3: å®Œæ•´å¯¹è¯ï¼ˆå¸¦ä¸Šä¸‹æ–‡ï¼‰

**ã€ç³»ç»Ÿæç¤ºè¯ã€‘**:
```
(åŒ…å«å¤§é‡ Claude Code ä¸Šä¸‹æ–‡ï¼Œçº¦40,000+ tokens)
- SessionStart hookæˆåŠŸ
- SuperpowersæŠ€èƒ½è¯´æ˜
- 46ä¸ªå¯ç”¨æŠ€èƒ½åˆ—è¡¨
- MCPå·¥å…·å®šä¹‰
- é¡¹ç›®ä¸Šä¸‹æ–‡ (3Dä¿„ç½—æ–¯æ–¹å—æ¸¸æˆ)
- CLAUDE.mdæŒ‡ä»¤
```

**ã€ç”¨æˆ·è¾“å…¥ã€‘**: "hi" (ç®€å•é—®å€™)

**ã€é…ç½®ã€‘**:
- max_tokens: 32000
- stream: true
- model: claude-sonnet-4-5 (æ›´å¼ºå¤§çš„æ¨¡å‹)

**ã€LLMå®Œæ•´å“åº”ã€‘**:
```
ä½ å¥½ï¼æˆ‘æ˜¯ Claude Codeï¼Œå¯ä»¥å¸®ä½ å¤„ç†è½¯ä»¶å·¥ç¨‹ä»»åŠ¡ã€‚

æˆ‘çœ‹åˆ°ä½ å½“å‰åœ¨ä¸€ä¸ª 3D ä¿„ç½—æ–¯æ–¹å—æ¸¸æˆé¡¹ç›®ä¸­
ï¼ˆä½¿ç”¨ vanilla JavaScript å’Œ Three.jsï¼‰ã€‚æˆ‘å¯ä»¥å¸®ä½ ï¼š

- æ·»åŠ æ–°åŠŸèƒ½æˆ–ä¿®å¤ bug
- è§£é‡Šä»£ç é€»è¾‘
- é‡æ„å’Œä¼˜åŒ–ä»£ç 
- åˆ›å»ºæˆ–ä¿®æ”¹æ–‡æ¡£
- Git æ“ä½œï¼ˆæäº¤ã€PR ç­‰ï¼‰

éœ€è¦æˆ‘å¸®ä½ åšä»€ä¹ˆå—ï¼Ÿ
```

**ã€Tokenä½¿ç”¨ã€‘**: 
- è¾“å…¥: ~40,000 tokens (åŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡)
- è¾“å‡º: ~593 tokens
- ç¼“å­˜åˆ›å»º: 32,932 tokens (+25%æˆæœ¬)
- ç¼“å­˜è¯»å–: 0 tokens

---

## ğŸ” å®¢æˆ·ç«¯äº¤äº’æ¨¡å¼åˆ†æ

### 1. **ä¸‰å±‚æ¶ˆæ¯ç»“æ„**

Claude Code CLI ä½¿ç”¨æ¸…æ™°çš„æ¶ˆæ¯å±‚çº§:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Billing Header (ç‰ˆæœ¬è¿½è¸ª)          â”‚
â”‚  cc_version=2.1.29.307               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§’è‰²å®šä¹‰ (å¯ç¼“å­˜)                   â”‚
â”‚  "You are Claude Code..."            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»»åŠ¡æŒ‡ä»¤ (å¯ç¼“å­˜)                   â”‚
â”‚  å…·ä½“çš„åˆ†ææˆ–å¤„ç†ä»»åŠ¡                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **Promptç¼“å­˜ç­–ç•¥**

**é™æ€å†…å®¹** â†’ æ ‡è®°ä¸º `cache_control: ephemeral`
- è§’è‰²å®šä¹‰
- é•¿æœŸä¸å˜çš„ç³»ç»ŸæŒ‡ä»¤
- å·¥å…·å®šä¹‰åˆ—è¡¨

**åŠ¨æ€å†…å®¹** â†’ ä¸ç¼“å­˜
- ç”¨æˆ·è¾“å…¥
- å®æ—¶ä¸Šä¸‹æ–‡
- å˜åŒ–çš„ä»»åŠ¡æè¿°

**ç¼“å­˜æ•ˆæœ**:
- åˆæ¬¡è¯·æ±‚: åˆ›å»ºç¼“å­˜ (~33,000 tokens @ +25%æˆæœ¬)
- åç»­è¯·æ±‚: è¯»å–ç¼“å­˜ (~90%æˆæœ¬èŠ‚çœ)
- ç¼“å­˜æœ‰æ•ˆæœŸ: 5åˆ†é’Ÿ

### 3. **æµå¼å“åº”**

**93%çš„è¯·æ±‚ä½¿ç”¨streaming**:
- å®æ—¶æ˜¾ç¤ºå“åº”å†…å®¹
- æ”¹å–„ç”¨æˆ·ä½“éªŒ
- ä¸å½±å“tokenè®¡è´¹

**SSE (Server-Sent Events) æ ¼å¼**:
```
event: message_start
data: {"usage": {"input_tokens": 10, "output_tokens": 0}}

event: content_block_delta
data: {"delta": {"text": "Hello"}}

event: content_block_delta
data: {"delta": {"text": " World"}}

event: message_delta
data: {"usage": {"input_tokens": 10, "output_tokens": 2}}
```

### 4. **ç»“æ„åŒ–è¾“å‡º (JSON Schema)**

50%çš„è¯·æ±‚ä½¿ç”¨JSON Schemaçº¦æŸ:

```javascript
{
  "output_config": {
    "format": {
      "type": "json_schema",
      "schema": {
        "type": "object",
        "properties": {
          "isNewTopic": {"type": "boolean"},
          "title": {"type": "string"}
        },
        "required": ["isNewTopic", "title"]
      }
    }
  }
}
```

**ç”¨é€”**:
- æ–°è¯é¢˜æ£€æµ‹
- å¯¹è¯æ ‡é¢˜ç”Ÿæˆ
- ç¡®ä¿è¾“å‡ºå¯è§£æ

### 5. **å·¥å…·è°ƒç”¨ä¼˜åŒ–**

**å·¥å…·å®šä¹‰ç­–ç•¥**:
- ä¸€æ¬¡æ€§ä¼ é€’æ‰€æœ‰46ä¸ªå·¥å…·
- å·¥å…·å®šä¹‰æ¶ˆè€— ~10,000 tokens
- ä½¿ç”¨ max_tokens=1 å¿«é€Ÿè®¡æ•°

**MCPå·¥å…·ç±»å‹**:
```
- web-search-prime: ç½‘é¡µæœç´¢
- web-reader: URLå†…å®¹æå–
- playwright: æµè§ˆå™¨è‡ªåŠ¨åŒ–
- context7: æ–‡æ¡£æŸ¥è¯¢
- greptile: ä»£ç åˆ†æ
- zai-mcp-server: å›¾åƒ/è§†é¢‘åˆ†æ
- chrome-devtools: DevToolsäº¤äº’
```

---

## ğŸ¯ å…³é”®è®¾è®¡æ¨¡å¼

### 1. **ä¸Šä¸‹æ–‡æ³¨å…¥**

æ¯ä¸ªè¯·æ±‚åŒ…å«:
- å½“å‰å·¥ä½œç›®å½•
- Gitä»“åº“çŠ¶æ€
- é¡¹ç›®ç±»å‹è¯†åˆ«
- CLAUDE.mdæŒ‡ä»¤
- å¯ç”¨æŠ€èƒ½åˆ—è¡¨

â†’ LLMèƒ½å¤Ÿ"çœ‹åˆ°"å®Œæ•´çš„å·¥ä½œç¯å¢ƒ

### 2. **ç‰ˆæœ¬è¿½è¸ª**

Billing headerè®°å½•:
- Claude Codeç‰ˆæœ¬ (cc_version=2.1.29.307)
- å…¥å£ç‚¹ (cc_entrypoint=cli)

â†’ ä¾¿äºè°ƒè¯•å’Œæˆæœ¬åˆ†æ

### 3. **å¤šæ¨¡å‹ç­–ç•¥**

- **Haiku 4.5**: ç®€å•ä»»åŠ¡ (è¯é¢˜æ£€æµ‹ã€è®¡æ•°)
- **Sonnet 4.5**: å¤æ‚ä»»åŠ¡ (ä»£ç å®¡æŸ¥ã€å®Œæ•´å¯¹è¯)

â†’ æˆæœ¬ä¸æ€§èƒ½çš„å¹³è¡¡

### 4. **æ¸è¿›å¼äº¤äº’**

```
ç”¨æˆ·: "hi"
  â†“
LLM: "æˆ‘æ˜¯Claude Codeï¼Œçœ‹åˆ°ä½ åœ¨3Dæ¸¸æˆé¡¹ç›®ä¸­..."
  â†“
ç”¨æˆ·: "å¸®æˆ‘reviewä»£ç "
  â†“
LLM: è°ƒç”¨code-reviewæŠ€èƒ½...
```

â†’ ä¸Šä¸‹æ–‡é€æ­¥ç´¯ç§¯ï¼Œé¿å…ä¸€æ¬¡æ€§ä¼ é€’è¿‡å¤šä¿¡æ¯

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| å¹³å‡è¾“å…¥tokens | ~2,900/è¯·æ±‚ |
| å¹³å‡è¾“å‡ºtokens | ~150/è¯·æ±‚ |
| æµå¼å“åº”æ¯”ä¾‹ | 93% |
| ç¼“å­˜ä½¿ç”¨æ¯”ä¾‹ | 47% |
| ç»“æ„åŒ–è¾“å‡ºæ¯”ä¾‹ | 50% |
| å·¥å…·è°ƒç”¨æ¯”ä¾‹ | 7% |

---

## ğŸ’¡ ä¼˜åŒ–äº®ç‚¹

1. **æé™Tokenæ§åˆ¶**: max_tokens=1 ç”¨äºå¿«é€Ÿè®¡æ•°
2. **æ™ºèƒ½ç¼“å­˜**: é™æ€å†…å®¹ç¼“å­˜5åˆ†é’Ÿï¼ŒèŠ‚çœ90%æˆæœ¬
3. **æŒ‰éœ€åŠ è½½**: åªåœ¨éœ€è¦æ—¶ä¼ é€’å·¥å…·å®šä¹‰
4. **æ ¼å¼çº¦æŸ**: JSON Schemaç¡®ä¿è¾“å‡ºå¯è§£æ
5. **ç‰ˆæœ¬è¿½è¸ª**: Billing headerä¾¿äºæˆæœ¬å½’å› 

---

## ğŸš¨ å‘ç°çš„é—®é¢˜

âš ï¸ **OAuthè®¤è¯å¤±è´¥**: æ‰€æœ‰è¯·æ±‚éƒ½æ˜¾ç¤º "Failed to get OAuth token" é”™è¯¯
- Providerå¯èƒ½é…ç½®äº† `auth_mode: oauth`
- ä½†OAuth tokenæœªæ­£ç¡®è·å–æˆ–å·²è¿‡æœŸ
- å»ºè®®æ£€æŸ¥ `~/.llm-gateway/oauth_tokens.json`
- æˆ–åˆ‡æ¢ä¸º `auth_mode: bearer` ä½¿ç”¨API key

---

## æ€»ç»“

Claude Code CLI å±•ç¤ºäº†ä¸€ä¸ªé«˜åº¦ä¼˜åŒ–çš„LLMäº¤äº’æ¨¡å¼ï¼š

âœ… **ä¸Šä¸‹æ–‡ä¸°å¯Œ**: æ¯ä¸ªè¯·æ±‚åŒ…å«å®Œæ•´çš„é¡¹ç›®ç¯å¢ƒ
âœ… **æˆæœ¬ä¼˜åŒ–**: ä½¿ç”¨promptç¼“å­˜å’Œæé™tokenæ§åˆ¶
âœ… **ç”¨æˆ·ä½“éªŒ**: 93%æµå¼å“åº”ï¼Œå®æ—¶åé¦ˆ
âœ… **è¾“å‡ºå¯é **: JSON Schemaçº¦æŸç¡®ä¿æ ¼å¼æ­£ç¡®
âœ… **å·¥å…·ä¸°å¯Œ**: 46ä¸ªMCPå·¥å…·è¦†ç›–å¤šç§åœºæ™¯

è¿™æ˜¯ä¸€ä¸ªå€¼å¾—å­¦ä¹ çš„ **ç”Ÿäº§çº§LLMé›†æˆæ¡ˆä¾‹**ï¼
